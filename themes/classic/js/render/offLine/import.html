<html> 
    <head>
        <!-- SEMPRE MANTER ATUALIZADO COM O LAYOUT DO RENDER !!!  -->
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" type="text/css" href="css/reset.css" media="screen, projection" />
        <link rel="stylesheet" type="text/css" href="css/render/global.css">
        <link rel="stylesheet" type="text/css" href="css/render/login.css">
        <link rel="stylesheet" type="text/css" href="css/render/fonts.css">
        <link rel="stylesheet" type="text/css" href="css/print.css" media="print" />
        <!---[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="<?php echo Yii::app()->theme->baseUrl; ?>/css/ie.css" media="screen, projection" />
        <![endif]-->
        <script src="js/jquery/jquery-1.7.2.js"></script>
        <script src="js/jquery/jquery.ui.core.js"></script>
        <script src="js/jquery/jquery.ui.widget.js"></script>
        <script src="js/jquery/jquery.ui.mouse.js"></script>
        <script src="js/jquery/jquery.ui.draggable.js"></script>
        <script src="js/jquery/jquery.ui.droppable.js"></script>
        <script type="text/javascript" src="js/render/meet.js"></script>
        <script type="text/javascript" src="js/render/domcobject.js"></script>
        <script type="text/javascript" src="js/jquery.shuffle.js"></script>
        <!-- Abrir Script do renderDB --> 
        <script type="text/javascript" src="db/renderDB.js"></script>
        <script type="text/javascript" src="data/json/renderData.js"></script>
        <script>
                
                 function existInArray(array, id){
                    for(var i in array){
                        if(array[i].id == id){
                            return true;
                        }
                    }
                    return false;
                }
            
            
            $(document).ready(function(){
                
                //Criar Objeto para Manipulação do Banco
                var db = new DB();
                
                $('#deleteAllDB').on('click', function(){
                    indexedDB.deleteDatabase("synapseDB");
                });
                
                $('#import').on('click',function(){
                    var unitys = new Array();
                    var actors = new Array();
                    
                    //Percorrer todos objetos existentes no ActorsOwnUnity
                    $.each(dataJson.ActorsOwnUnity, function(idx, object){
                        var tempUnity = {};
                        tempUnity.id =  object.unity_id;
                        tempUnity.father_id =  object.unity_father;
                        tempUnity.name =  object.unity_name;
                        tempUnity.organization_id =  object.unity_organization_id;
                        if(!existInArray(unitys,tempUnity.id)){
                            unitys.push(tempUnity);
                        }
                        var tempActor = {};
                        tempActor.id =  object.id;
                        tempActor.login =  object.login;
                        tempActor.name =  object.name;
                        tempActor.password =  object.password;
                        tempActor.personage_name =  object.personage;
                        //Chave Estrageira para a sua unidade
                        tempActor.unity_id = object.unity_id;
                         if(!existInArray(actors,tempActor.id)){
                           actors.push(tempActor);
                        }
                        
                    });
                    var disciplines = dataJson.Disciplines;
                    var cobjectblock = dataJson.CobjectBlock;
                    var cobject_cobjectblocks = dataJson.Cobject_cobjectBlocks;
                    var cobjects = dataJson.Cobjects;
                    
                    
                    //2° Importar
                    db.importAllDataRender(unitys, actors, disciplines, cobjectblock
                    ,cobject_cobjectblocks,cobjects);
                    
                });
                $('#buildAllSchemas').on('click',function(){
                    //1° Criar
                    db.openDBuild(true);
                });
                $('#back').on('click',function(){
                    location.href = "index.html";
                });
            }); 
    
        </script>
        <title>Import</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>
    
    <body>
        <section id="import-form" class="middle">
            <div id="import_data">
                <button class="login-button buttons" type="button" id="deleteAllDB"> Limpar Banco </button>  
                <button class="login-button buttons" type="button" id="buildAllSchemas" name="buildAllSchemas" >Construir Esquemas</button>
                <button class="login-button buttons" type="button" id="import" name="import" >Importar Dados</button>
                <button class="back-button buttons" type="button" id="back" name="back" >Voltar</button>
            </div>
        </section>
    </body>
</html>



<!DOCTYPE html>

<html> 
    <head>
        <script type="text/javascript">
            if (sessionStorage.getItem("authorization") == null || sessionStorage.getItem("authorization") == 'false') {
                location.href = 'login.html';
            }
        </script>
        <!-- SEMPRE MANTER ATUALIZADO COM O LAYOUT DO RENDER !!!  -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width; initial-scale=1.2; maximum-scale=1.2; target-densitydpi=medium-dpi; user-scalable=no" />
        <link rel="stylesheet" type="text/css" href="css/reset.css" />
        <link rel="stylesheet" type="text/css" href="css/print.css" media="print" />
        <link rel="stylesheet" type="text/css" href="css/render/render.css">
        <link rel="stylesheet" type="text/css" href="css/reset.css">
        <link rel="stylesheet" type="text/css" href="css/render/global.css">
        <link rel="stylesheet" type="text/css" href="css/render/meet.css">
        <link rel="stylesheet" type="text/css" href="css/render/fonts.css">
        <!---[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="<?php echo Yii::app()->theme->baseUrl; ?>/css/ie.css" media="screen, projection" />
        <![endif]-->
        <script src="js/jquery/jquery-1.7.2.js"></script>

        <script src="js/jquery/jquery.ui.core.js"></script>
        <script src="js/jquery/jquery.ui.widget.js"></script>
        <script src="js/jquery/jquery.ui.mouse.js"></script>
        <script src="js/jquery/jquery.ui.touch-punch.min.js"></script>
        <script src="js/jquery/jquery.ui.draggable.js"></script>
        <script src="js/jquery/jquery.ui.droppable.js"></script>

        <!-- JQUERY FOR MOBILE-->
        <script type="text/javascript" src="js/jquery/mobile/jquery.mobile-1.4.3/jquery.mobile-1.4.3.js"></script>
        <!-- ================= -->

        <script type="text/javascript" src="js/render/meet.js"></script>
        <script type="text/javascript" src="js/render/domcobject.js"></script>
        <script type="text/javascript" src="js/jquery.shuffle.js"></script>

        <!-- Abrir Script do renderDB --> 
        <script type="text/javascript" src="db/renderDB.js"></script>
        <script>

            /**
             * @param {mixed} variable The variable to check.
             * 
             * @returns {boolean} A Boolean containing TRUE if the variable is seted and FALSE if it's not seted.
             */
            function isset(variable) {
                return (variable !== undefined && variable !== null);
            }
            /**
             * @param {DOMString} IF A DOMString containing the name of the key you want to retrieve the value of.
             * @param {DOMString} ELSE A DOMString containing the name of the key you want to retrieve the value of in case that IF is not seted.
             * 
             * @returns {DOMString} A DOMString containing the value of the key. If the key does not exist, null is returned.
             */
            function sessionGet(IF, ELSE) {
                if (isset(ELSE)) {
                    return isset(sessionStorage.getItem(IF))
                            ? sessionStorage.getItem(IF)
                            : sessionStorage.getItem(ELSE);
                } else {
                    return sessionStorage.getItem(IF);
                }
            }
            

            $(document).ready(function () {

                //Somente para retirar o 'loading' que o jquery cria automaticamente
                $(".ui-loader.ui-corner-all.ui-body-a.ui-loader-default").css('display', 'none');

                if (window.openDatabase) {
                    console.log("Suporta BD-HTML5");

                    var org = '';
                    var classe = '';

                    //var unityfather_name = ''; 
                    var org_name = '';
                    var classe_name = '';

                    //Verificar se existe um aluno selecionado pelo tutor
                    //Ou se foi o próprio aluno que realizou login
                    var id_actor = sessionGet('id_actor', 'login_id_actor');
                    var name_actor = sessionGet('name_actor', 'login_name_actor');
                    //Personagem de quem fez o login
                    var login_personage_name = sessionGet('login_personage_name');

                    //Selecionar o Bloco de Atividades
                    var discipline_id = sessionGet('id_discipline');
                    var block_id;
                    switch (discipline_id) {
                        case '1':
                            block_id = '4';
                            break; //Linguagem
                        case '2':
                            block_id = '5';
                            break; //Matemática   
                    }

                    var options = {
                        org: [org, org_name],
                        classe: [classe, classe_name],
                        actor: [id_actor, name_actor, login_personage_name],
                        id_discipline: discipline_id,
                        cobject_block_id: block_id
                    };

                    //Passar parâmetro do tipo do Encontro
                    var newMeet = new Meet(options);


                    //Atualizar O painel do render
                    $('.info.info-name').html('<p>' + newMeet.actor_name + '</p>');
                    $('.info.info-hits .info-text').html(newMeet.peformance_qtd_correct);
                    $('.info.info-erros .info-text').html(newMeet.peformance_qtd_wrong);

                    //Mostrar/Ocultar barra de informações
                    $('#info-button').bind('tap', function () {
                        if ($('#head_meet').is(':visible')) {
                            $('#head_meet').hide();
                            $('#info-button').css('left', '0');
                            $('#info-button').removeClass('menu-close');
                            $('#info-button').addClass('menu-open');
                        } else {
                            $('#head_meet').show();
                            $('#info-button').css('left', '156px');
                            $('#info-button').removeClass('menu-open');
                            $('#info-button').addClass('menu-close');
                        }
                    });

                    // Encerrar atendimento
                    $(".info-exit").bind('tap', function () {
                        $("#finalize-message").show();
                    });
                    $("#finalize-icon").bind('tap', function () {
                        newMeet.finalizeMeet();
                    });
                    $("#close-icon").bind('tap', function () {
                        $("#finalize-message").hide();
                    });
                }
            });

        </script>
        <title>Render</title>
        <link rel="icon" type="image/png" href="icons/icon-48.png" /> 
    </head>
    <body id="synapse" ondragstart='return true'>

        <!-- Barra de informações -->
        <div id="head_meet">
            <div class="info info-name">

            </div>
            <div class="info info-time">
                <img class="info-icon" src="img/icons/clock.png" alt="Relógio">
                <p class="info-text"></p>
                <div class="clear"></div>
            </div>
            <div class="info info-hits">
                <img class="info-icon" src="img/icons/hit.png" alt="Acerto">
                <p class="info-text"></p>
                <div class="clear"></div>
            </div>
            <div class="info info-erros">
                <img class="info-icon" src="img/icons/error.png" alt="Erro">
                <p class="info-text"></p>
                <div class="clear"></div>
            </div>
            <a class="info-exit" href="#">
                <img class="info-icon" src="img/icons/exit.png" alt="Sair">
                <p class="info-text">Encerrar Atendimento</p>
                <div class="clear"></div>
            </a>
        </div>

        <div id="info-button" class="menu-open">

        </div>

        <div id="message"> 
        </div>

        <div id="render_canvas">
        </div>

        <div class="game">
            <div class="level">
                <p class="score-number"><i class="fa fa-flash"></i> <span id="level">0</span></p>
            </div>
            <div class="points">
                <p class="score-number"><i class="fa fa-star"></i> <span id="points">0</span></p>
            </div>
        </div>

        <!-- Acerto -->
        <div id="hit-message" class="modal_message overlay">
            <div class="message-container success">
                <img class="ok message-icon" src="img/icons/hit.png">
                <p class="message">Parabéns!<br>Você acertou!! \o/</p>
                <button class="message-button">OK</button>
            </div>
        </div>

        <!-- Erro -->
        <div id="error-message" class="modal_message overlay">
            <div class="message-container error">
                <img class="ok message-icon" src="img/icons/error.png">
                <p class="message">Que peninha<br/>você errou :/</p>
                <button class="message-button">OK</button>
            </div>
        </div>

        <!-- Encerrar atividade -->
        <div id="finalize-message" class="overlay">
            <div class="message-container exit">
                <p class="message">Deseja encerrar<br>o atendimento desse aluno?</p>
                <img id="finalize-icon" class="message-icon" src="img/icons/hit.png">
                <img id="close-icon" class="message-icon" src="img/icons/error.png">
            </div>
        </div>

        <!-- Avanço de Nível -->
        <div id="nextLevel-message" class="nextLevel-message modal_message overlay">
            <div class="message-container success">
                <img class="ok message-icon" src="img/icons/raio_telapassagem.png">
                <p class="message">Parabéns!<br>Você passou de nível!</p>
                <button class="message-button">OK</button>
            </div>
        </div>

        <!-- Avanço do Último Nível -->
        <div id="finishLevel-message" class="nextLevel-message modal_message overlay">
            <div class="message-container success">
                <img class="ok message-icon" src="img/icons/raio_telapassagem.png">
                <p class="message">Parabéns, Por Finalizar essa Etapa!</p>
                <button class="message-button">OK</button>
            </div>
        </div>

    </body>
</html>

